<table style='width:50%'>
    <tr>
      <th>Position</th>
      <th>Name</th>
      <th>Points</th>
      <th>Salary</th>
    </tr>

    <% Position.all.each do |position| %>
      <% if @team.get(position).nil? %>
        <tr class="player_profile">
          <th><%= position.name %></th>
          <th><%= render partial: 'add_player', locals: {position: position.name} %></th>
        </tr>
      <% else %>
        <tr id="playerid-<%=@team.get(position).id%>">
          <th><%= position.name %></th>
          <th><a href='#' onclick="loadPlayer('<%=@team.get(position).id%>')"><%= @team.get(position).name %></a></th>
          <th><%= @team.get(position).points %></th>
          <th><%= @team.get(position).salary %></th>
          <th><%= render partial: 'delete_player', locals: {player: @team.get(position)} %></th>
        </tr>
      <% end %>
    <% end %>

  </table>

  <script id="player-template" type="text/x-handlebars-template">
      <h4>{{name}} -- {{position}} -- {{pro_team}}</h4><br>
      <p>Salary: ${{salary}}</p><br>
      <p>Points: ${{points}}</p><br>
      <h4>Stats</h4><br>
      <ul>
        <li>TDs: {{touchdowns}}</p><br>
        <li>Passing Yards: {{pass_yards}}</li><br>
        <li>Rushing Yards: {{rush_yards}}</li><br>
        <li>Receptions: {{receptions}}</li><br>
        <li>Receiving Yards: {{rec_yards}}</li><br>
      </ul>
  </script>

<script type="text/javascript" charset="utf-8">
function loadPlayer(player_id) {
      event.preventDefault()
      var url = '/players/' + player_id
      fetch(url)
        .then(response => response.json())
        .then(function(data) {
          var player = {
            name: data.data.attributes.name,
            position: data.data.attributes.position.name,
            salary: data.data.attributes.salary,
            points: data.data.attributes.points,
            pro_team: data.data.attributes["pro-team"],
            touchdowns: data.data.attributes.touchdowns,
            pass_yards: data.data.attributes["pass-yards"],
            rush_yards: data.data.attributes["rush-yards"],
            receptions: data.data.attributes.receptions,
            rec_yards: data.data.attributes["rec-yards"]
          }
          var template = Handlebars.compile(document.getElementById("player-template").innerHTML)
          var result = template(player)
          var element = Array.from($('#playerid-' + data.data.id))
          element[0].innerHTML = result
        })

      return false
    }
</script>
