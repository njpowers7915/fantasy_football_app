<h2> <%= @team.name %> </h2><br>

<p>Total Points: <%= @team.points_total %></p><br>
<p>Available Salary: $ <%= @team.available_salary %></p><br>

<div id=leagueContainer>
<% if @team.league.nil? %>
  <% if is_admin? %>
    <h4><%= link_to "Create League", new_league_path %></h4>
  <% else %>
    <h4><a href='#' onclick="showLeagues()">Join a League</a></h4>
  <% end %>
<% else %>
  <h4><%= link_to "#{@team.league.name} -- League Homepage", league_path %></h4>
<% end %>
<br>
</div>

<br>
<%= render 'roster' %>

<script type="text/javascript" charset="utf-8">
function showLeagues() {
  event.preventDefault()
  var leagueContainer = Array.from($('#leagueContainer'))[0]
  leagueContainer.innerHTML = ('<h4>Fantasy Football Leagues</h4>')
  fetch('/leagues')
    .then(response => response.json())
    .then(function(data) {
      let leagues = data.data

      leagues.forEach(function(league) {
        leagueContainer.innerHTML += ('<li>'
          + league.attributes.name + ' <button onclick="joinLeague(' + league.id + ')">JOIN</button></li><br>')
      })
    })
}
</script>

<script type="text/javascript" charset="utf-8">
function joinLeague(leagueID) {
  debugger
  event.preventDefault()
  var values
  var thisURL = this.location.pathname.split('/')
  var currentTeamId = thisURL[thisURL.length - 1]
  var teamData = { league_id: leagueID };

  $.ajax({
    type: 'PATCH',
    url: `/teams/${currentTeamId}`,
    data: teamData
  })
}
</script>



<script type="text/javascript" charset="utf-8">
  //$('form').submit(function(event) {
  //    //event.preventDefault();
  //    $(this).hide();
  //    var values = $(this).serialize();

  //    $.post('/teams', values, function(team) {
  //      currentTeam = team.data.id
  //      urlWithParams = "/users/" + team.data.attributes.user.id + "/teams/" + currentTeam
  //      $("#existingTeams").append('<li><a href=' + urlWithParams + '>' + team.data.attributes.name + '</a></li>')
  //    })
  //    return false
  //  });
</script>
