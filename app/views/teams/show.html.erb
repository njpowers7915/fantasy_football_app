<h2> <%= @team.name %> </h2><br>

<p>Total Points: <%= @team.points_total %></p><br>
<p>Available Salary: $ <%= @team.available_salary %></p><br>

<div id="leagueContainer">
<% if @team.league.nil? %>
  <% if is_admin? %>
    <h4><a href='#' onclick="createNewLeagueForm()">Create League</a></h4>
  <% else %>
    <h4><a href='#' onclick="showLeagues()">Join a League</a></h4>
  <% end %>
<% else %>
  <h4><%= link_to "#{@team.league.name} -- League Homepage", league_path(@team.league) %></h4>
<% end %>
<br>
<div id="newLeagueForm"></div>
</div>

<br>
<%= render 'roster' %>

<script type="text/javascript" charset="utf-8">
function createNewLeagueForm() {
  event.preventDefault();
  $('#newLeagueForm').html("<%= j (render 'leagues/new_league') %>")
}
</script>

<script type="text/javascript" charset="utf-8">
function showLeagues() {
  event.preventDefault()
  var leagueContainer = Array.from($('#leagueContainer'))[0]
  leagueContainer.innerHTML = ('<h4>Fantasy Football Leagues</h4>')
  fetch('/leagues')
    .then(response => response.json())
    .then(function(data) {
      let leagues = data.data

      leagues.forEach(function(league) {
        leagueContainer.innerHTML += ('<li>'
          + league.attributes.name + ' <button onclick="joinLeague(' + league.id + ')">JOIN</button></li><br>')
      })
    })
}
</script>

<script type="text/javascript" charset="utf-8">
$(document).ready(function() {
  attachListeners();
});

function attachListeners() {
  $('button').on('click', function() {
    joinLeague(leagueID);
  })
}

function joinLeague(leagueID) {
  event.preventDefault()
  var thisURL = this.location.pathname.split('/')
  var currentTeamId = thisURL[thisURL.length - 1]
  var teamData = { league_id: leagueID };

  $.ajax({
    type: 'PATCH',
    url: `/teams/${currentTeamId}`,
    contentType: 'application/json',
    data: JSON.stringify({
      league_id: leagueID
    }),
  })
}
</script>
