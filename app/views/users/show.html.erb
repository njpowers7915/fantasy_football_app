<% if @message %>
  <div class="center alert">
    <p><%= @message %></p>
  </div>
<% end %>

<% if is_admin? %>
<h4>LEAGUE ADMIN</h4>
<% end %>

<h2>Welcome <%= @user.name %>!</h2><br>

<div id="existingTeams">
<% @user.teams.each do |team| %>
  <li><%= link_to team.name, user_team_path(@user, team) %></li>
<% end %>
</div>

<% if is_admin? %>
  <div class="newLeague">
    <br>
    <h4><%= link_to "Create League", new_user_team_path(@user, @team) %></h4>
    <br>
  </div>
<% else %>
  <div id="newTeam">
    <br>
    <h4><a href='#' onclick='createNewTeamForm()'>Create New Team</a></h4>
    <br>
    <div id="newTeamForm"></div>
  </div>
<% end %>

<script type="text/javascript" charset="utf-8">
function createNewTeamForm() {
  event.preventDefault();
  $('#newTeamForm').html("<%= j (render 'teams/new_team') %>")
}
</script>

<br>

<div id="player_stats">Stat Leaders: <select id="stat_dropdown">
  <option value="points">Total Points</option>
  <option value="touchdowns">Touchdowns</option>
  <option value="pass-yards">Pass Yards</option>
  <option value="rush-yards">Rush Yards</option>
  <option value="receptions">Receptions</option>
  <option value="rec-yards">Rec. Yards</option>
</select>
  <button id="submit_player_stats" onclick='getStatLeaders()'>Search</button>
</div>
<div id="statLeaders"></div>

<script type="text/javascript" charset="utf-8">
function getStatLeaders() {
      event.preventDefault()
      $.getJSON('/players', function(data) {
        var playerArray = []
        data.data.forEach(function (player) {
          var stat = $('option:selected')[0].value
          var individualArray = [player.attributes.name, player.attributes.position.name,
            player.attributes["pro-team"], player.attributes[stat]]
          playerArray.push(individualArray)
        })
        var statArray = playerArray.sort(function (a, b) {
          return b[3] - a[3]
        }).slice(0, 5)

        debugger
        var player = {
          name: data.data.attributes.name,
          position: data.data.attributes.position.name,
          salary: data.data.attributes.salary,
          points: data.data.attributes.points,
          touchdowns: data.data.attributes.touchdowns,
          pass_yards: data.data.attributes["pass-yards"],
          rush_yards: data.data.attributes["rush-yards"],
          receptions: data.data.attributes.receptions,
          rec_yards: data.data.attributes["rec-yards"]
        }
        var template = Handlebars.compile(document.getElementById("stat_leader_template").innerHTML)
        var result = template(players)
        document.getElementsByTagName("statLeaders")[0].innerHTML += result
      })
      return false
    }
</script>

<script id="stat_leader_template" type="text/x-handlebars-template">
  <div id="stat_header">
    <h4>{{stat}} Leaders</h4>
    <div id="stat_body">
      <table style='width:50%'>
        <tr>
          <th>#</th>
          <th>Name</th>
          <th>Position</th>
          <th>Pro-Team</th>
          <th>{{stat}}</th>
        </tr>
        {{#each this}}
        <tr>
          <td></td>
          <td>{{name}}</td>
          <td>{{position}}</td>
          <td>{{pro_team}}</td>
          <th>{{stat}}</th>
        </tr>
        {{/each}}
      </table>
    </div>
  </div>
</script>
